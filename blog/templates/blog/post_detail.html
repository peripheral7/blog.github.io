{% extends 'blog/base.html' %}

<!--Bring head_title block from file that extends base.html-->
<!-- if not, use title from base.html -->
{% block head_title %}
{{ post.title }} - Blog
{% endblock %}

{% block main_area %}
<article class="my-4 px-4 post-content" id="post-area">
    <!-- Post header-->
    <header class="">
        <h1 class="fw-bolder mb-4">
        {% if post.category %}
        <a class="text-decoration-none text-dark" href="{{ post.category.get_absolute_url}}">
        <span >{{ post.category }} / </span></a>
        {% else %}
        <a href="/blog/category/no_category text-dark"><span ></span></a>
        {% endif %}
            {{ post.title}}
        </h1>


        <!-- Post meta content-->
        <div class="my-4 text-muted d-flex justify-content-end">
            <div class="post-detail-meta">
                by&nbsp;<a href="#" >{{post.author}}</a>, {{ post.created_at}}&nbsp;

                {% if user.is_authenticated and user == post.author %}
                <a class="btn btn-sm" href="/blog/update_post/{{post.pk}}/" role="button">
                    <i class="fas fa-pen"></i> Edit
                </a>
                {% endif %}
            </div>
        </div>
    </header>

    <!-- Preview image figure-->
    <figure class="my-5 d-flex justify-content-center">
        {% if post.head_image %}
        <img class="card-img-top detail-image" src="{{ post.head_image.url }}" alt="{{post}} head image" />
        {% endif %}
    </figure>

    <!-- Post content-->
    <section class="my-4">
        <!-- safe prevents HTML escaping-->
        <!-- rendering HTML used tags into HTML entity -->
        <p class="post-content fs-5 mb-4">{{post.get_content_markdown | safe }}</p>

        <!-- <h2 class="fw-bolder mb-4 mt-5">I have odd cosmic thoughts every day</h2> -->
    </section>

    <section class="my-3 d-flex justify-content-end">
        {% if post.file_upload %}
        <a class="btn btn-outline-dark" href="{{ post.file_upload.url }}" role="button" download>
            {% if post.get_file_ext == 'csv' %}
            <i class="fas fa-file-csv"></i>
            {% elif post.get_file_ext == 'xlsx' or post.get_file_ext == 'xls'%}
                <i class="fas fa-file-excel"></i>
            {% elif post.get_file_ext == 'docx' or post.get_file_ext == 'doc'%}
                <i class="fas fa-file-word"></i>
            {% else %}
            <i class="far fa-file"></i>
            {% endif %}
            {{post.get_file_name}}
        </a>
        {% endif %}
    </section>

    <div class="d-flex justify-content-end">
        {% if post.tags.exists %}
            {% for tag in post.tags.iterator %}
            <a class="text-decoration-none" href="{{tag.get_absolute_url}}">
                <span class="badge text-bg-light">#{{tag}}</span>
            </a>
          {% endfor %}
        {% endif %}
    </div>

</article>

<!-- Comments section-->
<section class="my-7" id="comment-area">
    <div class="card bg-light">
        <div class="card-body">
            <!-- Comment form-->
            <form class="mb-4"><textarea class="form-control" rows="3"
                    placeholder="Join the discussion and leave a comment!"></textarea></form>
            {% if post.comment_set.exists %}
                {% for comment in post.comment_set.iterator %}
                    <div class="d-flex mb-4" id="comment-{{ comment.pk }}">
                        <!-- Parent comment-->
                        <div class="flex-shrink-0"><img class="rounded-circle"
                                src="https://dummyimage.com/50x50/ced4da/6c757d.jpg" alt="..." /></div>
                        <div class="ms-3">
                            <div class="fw-bold">
                                {{ comment.author.username }}
                                &nbsp;&nbsp;<small class="text-muted">{{comment.created_at}}</small></div>
                            <p class="comment-p">{{ comment.content | linebreaks }}</p>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}

